{% extends "base.html" %} {% block title %}Reset Password - Inventory Management
System{% endblock %} {% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow-lg mt-5">
        <div class="card-body p-5">
          <div class="text-center mb-4">
            <i class="bi bi-lock-fill text-warning" style="font-size: 3rem"></i>
            <h2 class="mt-3">Reset Password</h2>
            <p class="text-muted">Create your new password</p>
          </div>

          <form
            method="POST"
            action="{{ url_for('auth.reset_password') }}"
            id="resetPasswordForm"
          >
            <div class="mb-3">
              <label for="new_password" class="form-label">New Password</label>
              <div class="input-group">
                <span class="input-group-text">
                  <i class="bi bi-lock"></i>
                </span>
                <input
                  type="password"
                  class="form-control"
                  id="new_password"
                  name="new_password"
                  placeholder="Enter new password"
                  minlength="8"
                  required
                  autofocus
                />
                <button
                  class="btn btn-outline-secondary"
                  type="button"
                  id="togglePassword"
                  onclick="togglePasswordVisibility('new_password', this)"
                >
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              <small class="form-text text-muted">
                Must be at least 8 characters long
              </small>
            </div>

            <div class="mb-4">
              <label for="confirm_password" class="form-label"
                >Confirm Password</label
              >
              <div class="input-group">
                <span class="input-group-text">
                  <i class="bi bi-lock-fill"></i>
                </span>
                <input
                  type="password"
                  class="form-control"
                  id="confirm_password"
                  name="confirm_password"
                  placeholder="Confirm new password"
                  minlength="8"
                  required
                />
                <button
                  class="btn btn-outline-secondary"
                  type="button"
                  onclick="togglePasswordVisibility('confirm_password', this)"
                >
                  <i class="bi bi-eye"></i>
                </button>
              </div>
              <div id="passwordMatch" class="form-text"></div>
            </div>

            <!-- Password Strength Indicator -->
            <div class="mb-4">
              <div class="progress" style="height: 5px">
                <div
                  id="passwordStrength"
                  class="progress-bar"
                  role="progressbar"
                  style="width: 0%"
                ></div>
              </div>
              <small id="strengthText" class="form-text"></small>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-check-circle"></i> Reset Password
              </button>
            </div>
          </form>

          <hr class="my-4" />

          <div class="text-center">
            <a
              href="{{ url_for('auth.login') }}"
              class="text-decoration-none text-muted"
            >
              <i class="bi bi-arrow-left"></i> Back to Login
            </a>
          </div>
        </div>
      </div>

      <div class="card mt-3">
        <div class="card-body">
          <h6 class="card-title">
            <i class="bi bi-shield-check"></i> Password Requirements
          </h6>
          <ul class="mb-0 small">
            <li>At least 8 characters long</li>
            <li>Use a mix of letters, numbers, and symbols (recommended)</li>
            <li>Avoid using common words or personal information</li>
            <li>Don't reuse passwords from other accounts</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Toggle password visibility
  function togglePasswordVisibility(fieldId, button) {
    const field = document.getElementById(fieldId);
    const icon = button.querySelector("i");

    if (field.type === "password") {
      field.type = "text";
      icon.classList.remove("bi-eye");
      icon.classList.add("bi-eye-slash");
    } else {
      field.type = "password";
      icon.classList.remove("bi-eye-slash");
      icon.classList.add("bi-eye");
    }
  }

  // Password strength checker
  const newPassword = document.getElementById("new_password");
  const confirmPassword = document.getElementById("confirm_password");
  const strengthBar = document.getElementById("passwordStrength");
  const strengthText = document.getElementById("strengthText");
  const matchText = document.getElementById("passwordMatch");

  newPassword.addEventListener("input", function () {
    const password = this.value;
    let strength = 0;

    if (password.length >= 8) strength += 25;
    if (password.length >= 12) strength += 25;
    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 25;
    if (/[0-9]/.test(password)) strength += 15;
    if (/[^a-zA-Z0-9]/.test(password)) strength += 10;

    strengthBar.style.width = strength + "%";

    if (strength < 25) {
      strengthBar.className = "progress-bar bg-danger";
      strengthText.textContent = "Weak password";
      strengthText.className = "form-text text-danger";
    } else if (strength < 50) {
      strengthBar.className = "progress-bar bg-warning";
      strengthText.textContent = "Fair password";
      strengthText.className = "form-text text-warning";
    } else if (strength < 75) {
      strengthBar.className = "progress-bar bg-info";
      strengthText.textContent = "Good password";
      strengthText.className = "form-text text-info";
    } else {
      strengthBar.className = "progress-bar bg-success";
      strengthText.textContent = "Strong password";
      strengthText.className = "form-text text-success";
    }

    checkPasswordMatch();
  });

  confirmPassword.addEventListener("input", checkPasswordMatch);

  function checkPasswordMatch() {
    if (confirmPassword.value === "") {
      matchText.textContent = "";
      return;
    }

    if (newPassword.value === confirmPassword.value) {
      matchText.textContent = "✓ Passwords match";
      matchText.className = "form-text text-success";
    } else {
      matchText.textContent = "✗ Passwords do not match";
      matchText.className = "form-text text-danger";
    }
  }

  // Form validation
  document
    .getElementById("resetPasswordForm")
    .addEventListener("submit", function (e) {
      if (newPassword.value !== confirmPassword.value) {
        e.preventDefault();
        alert("Passwords do not match!");
        confirmPassword.focus();
      }
    });
</script>
{% endblock %}
