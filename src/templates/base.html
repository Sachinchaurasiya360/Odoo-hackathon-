<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="{% block meta_description %}Comprehensive inventory management system for tracking stock, warehouses, and operations{% endblock %}" />
    <meta name="theme-color" content="#4f46e5" />
    <title>{% block title %}Inventory Management System{% endblock %}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
      integrity="sha384-qDMvpkgb6kqlUJ7nKVKWM5VNiMdxdlpMvekGj7pGWKmz0l+7Wt4ISwxjKnJmEwWy"
      crossorigin="anonymous"
    />

    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/main.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/components.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/animations.css') }}"
    />

    {% block extra_css %}{% endblock %}
  </head>

  <body class="{% if not session.get('user_id') %}auth-page{% endif %}">
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link visually-hidden-focusable">Skip to main content</a>
    
    {% if session.get('user_id') %}
    <!-- ================== LOGGED-IN LAYOUT START ================== -->
    <div class="app-container" role="application" aria-label="Inventory Management Application">
      {% include 'components/sidebar.html' %}

      <main class="main-content" id="main-content" role="main">
        {% include 'components/navbar.html' %}

        <!-- FLASH MESSAGES (APP) -->
        {% with messages = get_flashed_messages(with_categories=true) %} 
        {% if messages %}
        <div class="flash-messages animate-fade-in-down" role="alert" aria-live="polite" aria-atomic="true">
          {% for category, message in messages %}
          <div
            class="alert alert-{{ category }} alert-dismissible fade show notification-enter"
            role="alert"
          >
            <i
              class="bi bi-{% if category == 'success' %}check-circle-fill{% elif category == 'danger' %}exclamation-circle-fill{% elif category == 'warning' %}exclamation-triangle-fill{% else %}info-circle-fill{% endif %}"
              aria-hidden="true"
            >
            </i>
            <span class="alert-message">{{ message }}</span>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close notification"
            ></button>
          </div>
          {% endfor %}
        </div>
        {% endif %} 
        {% endwith %}

        <div id="page-wrapper">
          {% else %}
          <!-- ================== AUTH LAYOUT START ================== -->

          <!-- FLASH MESSAGES (AUTH) -->
          {% with messages = get_flashed_messages(with_categories=true) %} 
          {% if messages %}
          <div class="container mt-4" role="alert" aria-live="polite">
            {% for category, message in messages %}
            <div
              class="alert alert-{{ category }} alert-dismissible fade show"
              role="alert"
            >
              <span class="alert-message">{{ message }}</span>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="alert"
                aria-label="Close notification"
              ></button>
            </div>
            {% endfor %}
          </div>
          {% endif %} 
          {% endwith %}

          <main class="auth-container mt-5" id="main-content" role="main">
            {% endif %}

            <!-- ======== COMMON CONTENT BLOCK ======== -->
            {% block content %}{% endblock %} 
            
            {% if session.get('user_id') %}
            <!-- ================== LOGGED-IN LAYOUT END ================== -->
          </div>
          <!-- End page-wrapper -->

          <footer class="page-footer" role="contentinfo">
            <div class="footer-content">
              <span>&copy; 2024 Inventory Management System. All rights reserved.</span>
              <nav class="footer-links" aria-label="Footer navigation">
                <a href="#" aria-label="Help and support">Help</a>
                <a href="#" aria-label="Privacy policy">Privacy</a>
                <a href="#" aria-label="Terms of service">Terms</a>
              </nav>
            </div>
          </footer>
        </main>
        <!-- End main-content -->
      </div>
      <!-- End app-container -->
      {% else %}
      <!-- ================== AUTH LAYOUT END ================== -->
    </main>
    <!-- End auth-container -->
    {% endif %}

    <!-- JS Files -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" 
            crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
