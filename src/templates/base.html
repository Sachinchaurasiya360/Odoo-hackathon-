<!DOCTYPE html>
<html lang="en" class="smooth-scroll">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="{% block meta_description %}Modern, comprehensive inventory management system for tracking stock, warehouses, and operations with real-time analytics{% endblock %}" />
    <meta name="theme-color" content="#4f46e5" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>{% block title %}Inventory Management System{% endblock %}</title>

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" />
    
    <!-- Google Fonts - Inter (optimized loading) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
      integrity="sha384-qDMvpkgb6kqlUJ7nKVKWM5VNiMdxdlpMvekGj7pGWKmz0l+7Wt4ISwxjKnJmEwWy"
      crossorigin="anonymous"
    />

    <!-- Custom CSS v2.0 - Modern Design System -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/design-system.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main-v2.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components-v2.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations-v2.css') }}" />

    {% block extra_css %}{% endblock %}
  </head>

  <body class="{% if not session.get('user_id') %}auth-page{% endif %}">
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    {% if session.get('user_id') %}
    <!-- ================== LOGGED-IN LAYOUT START ================== -->
    <div class="app-container" role="application" aria-label="Inventory Management Application">
      {% include 'components/sidebar.html' %}

      <main class="main-content" id="main-content" role="main">
        {% include 'components/navbar.html' %}

        <!-- FLASH MESSAGES (APP) -->
        {% with messages = get_flashed_messages(with_categories=true) %} 
        {% if messages %}
        <div class="flash-messages animate-fade-in-down" role="alert" aria-live="polite" aria-atomic="true">
          {% for category, message in messages %}
          <div
            class="alert alert-{{ category }} alert-dismissible fade show notification-enter elevation-4"
            role="alert"
          >
            <i
              class="bi bi-{% if category == 'success' %}check-circle-fill{% elif category == 'danger' %}exclamation-circle-fill{% elif category == 'warning' %}exclamation-triangle-fill{% else %}info-circle-fill{% endif %}"
              aria-hidden="true"
            >
            </i>
            <span class="alert-message">{{ message }}</span>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close notification"
            ></button>
          </div>
          {% endfor %}
        </div>
        {% endif %} 
        {% endwith %}

        <div id="page-wrapper" class="page-transition">
          {% else %}
          <!-- ================== AUTH LAYOUT START ================== -->

          <!-- FLASH MESSAGES (AUTH) -->
          {% with messages = get_flashed_messages(with_categories=true) %} 
          {% if messages %}
          <div class="container mt-4 animate-fade-in-down" role="alert" aria-live="polite">
            {% for category, message in messages %}
            <div
              class="alert alert-{{ category }} alert-dismissible fade show elevation-3"
              role="alert"
            <i
              class="bi bi-{% if category == 'success' %}check-circle-fill{% elif category == 'danger' %}exclamation-circle-fill{% elif category == 'warning' %}exclamation-triangle-fill{% else %}info-circle-fill{% endif %}"
              aria-hidden="true"
            >
            </i>
            <span class="alert-message">{{ message }}</span>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close notification"
            ></button>
          </div>
          {% endfor %}
        </div>
        {% endif %} 
        {% endwith %}

        <main class="auth-container mt-5 page-transition" id="main-content" role="main">
          {% endif %}

          <!-- ======== COMMON CONTENT BLOCK ======== -->
          {% block content %}{% endblock %} 
          
          {% if session.get('user_id') %}
          <!-- ================== LOGGED-IN LAYOUT END ================== -->
        </div>
        <!-- End page-wrapper -->

        <footer class="page-footer" role="contentinfo">
          <div class="footer-content">
            <span>&copy; 2024 Inventory Management System. All rights reserved.</span>
            <nav class="footer-links" aria-label="Footer navigation">
              <a href="#" class="focus-visible-only">Help</a>
              <span aria-hidden="true">•</span>
              <a href="#" class="focus-visible-only">Privacy</a>
              <span aria-hidden="true">•</span>
              <a href="#" class="focus-visible-only">Terms</a>
            </nav>
          </div>
        </footer>
      </main>
      <!-- End main-content -->
    </div>
    <!-- End app-container -->
    {% else %}
    <!-- ================== AUTH LAYOUT END ================== -->
  </main>
  <!-- End auth-container -->
  {% endif %}

  <!-- JS Files -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
          integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" 
          crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>

  {% block extra_js %}{% endblock %}
  
  <!-- Performance optimization -->
  <script>
    // Preload critical resources
    if ('IntersectionObserver' in window) {
      // Lazy load images
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.removeAttribute('data-src');
              observer.unobserve(img);
            }
          }
        });
      });

      document.querySelectorAll('img[data-src]').forEach(img => imageObserver.observe(img));
    }
    
    // Smooth scroll reveal animations
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('active');
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.scroll-reveal').forEach(el => revealObserver.observe(el));
  </script>
</body>
</html>
